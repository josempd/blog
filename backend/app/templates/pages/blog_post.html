{% extends "base.html" %}

{% block title %}{{ post.title }} &mdash; {{ site_title }}{% endblock %}
{% block description %}{% if post.excerpt %}{{ post.excerpt }}{% else %}{{ site_description }}{% endif %}{% endblock %}
{% block og_title %}{{ post.title }}{% endblock %}
{% block og_description %}{% if post.excerpt %}{{ post.excerpt }}{% else %}{{ site_description }}{% endif %}{% endblock %}
{% block og_type %}article{% endblock %}
{% block canonical %}{{ site_url }}/blog/{{ post.slug }}{% endblock %}
{% block og_url %}{{ site_url }}/blog/{{ post.slug }}{% endblock %}

{% block head_extra %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": {{ post.title | tojson }},
    "description": {{ (post.excerpt or site_description) | tojson }},
    {% if post.published_at %}"datePublished": "{{ post.published_at.isoformat() }}",{% endif %}
    {% if post.updated_at %}"dateModified": "{{ post.updated_at.isoformat() }}",{% endif %}
    "author": {
        "@type": "Person",
        "name": {{ site_author | tojson }},
        "url": {{ site_url | tojson }}
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": {{ (site_url ~ "/blog/" ~ post.slug) | tojson }}
    }
    {% if post.tags %},
    "keywords": {{ post.tags | map(attribute='name') | list | tojson }}
    {% endif %}
}
</script>
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
        {"@type": "ListItem", "position": 1, "name": "Blog", "item": {{ (site_url ~ "/blog") | tojson }}},
        {"@type": "ListItem", "position": 2, "name": {{ post.title | tojson }}, "item": {{ (site_url ~ "/blog/" ~ post.slug) | tojson }}}
    ]
}
</script>
{% endblock %}

{% block content %}
<article class="post-layout">
    <header class="page-header">
        <h1>{{ post.title }}</h1>
        <div class="post-meta">
            {% if post.published_at %}
            <time datetime="{{ post.published_at.isoformat() }}">{{ post.published_at.strftime('%b %d, %Y') }}</time>
            {% endif %}
        </div>
    </header>

    <div class="post-content">
        <div class="prose post-body">
            {{ post.content_html | safe }}
        </div>

        {% if post.tags %}
        <nav class="post-tags" aria-label="Post tags">
            {% for tag in post.tags %}
            <a href="/blog?tag={{ tag.slug }}" class="tag" rel="tag">{{ tag.name }}</a>
            {% endfor %}
        </nav>
        {% endif %}
    </div>

    {% if toc and toc | length > 1 %}
    <aside class="post-sidebar">
        <nav class="post-toc" aria-label="Table of contents" id="toc-nav">
            <h2>Contents</h2>
            <ol>
                {% for entry in toc %}
                <li class="toc-level-{{ entry.level }}">
                    <a href="#{{ entry.id }}">{{ entry.text }}</a>
                </li>
                {% endfor %}
            </ol>
        </nav>
        <div id="toc-island"></div>
    </aside>
    {% endif %}
</article>
{% endblock %}

{% block scripts %}
{% if toc and toc | length > 1 %}
    {% set toc_js = island_asset("TableOfContents") %}
    {% if toc_js %}
    <script type="module" src="{{ toc_js }}"></script>
    {% endif %}
{% endif %}
{% endblock %}
